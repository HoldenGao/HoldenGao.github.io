---
layout: post
title: 操作系统
tags: [operating system]
comments: true
thumbnail-img: "/assets/img/blog/LinuxPenguin.png"
share-img: ""
typora-copy-images-to: ../assets/img/blog
typora-root-url: ..
---

[toc]

### 一、操作系统

#### 1.1_1 操作系统的概念，功能和目标

常见操作系统：windows、andriod、ios、Macos、linux

操作系统的概念：（operating system，OS） 是指控制和管理整个计算机系统的硬件和软件资源，并合理地组织调度计算机的工作和资源的分配，以提供用户和其他软件方便的接口和环境，他是计算机系统最基本的**系统软件**。

> 操作系统的功能和目标：

补充知识：进程是一个程序的执行过程，**执行前需要讲该程序放到内存中**，才能被CPU处理

1. 作为系统资源的管理者：
   1. QQ聊天时，打开文件夹找到QQ.exe-----**文件管理**
   2. 需要把该程序放到内存中----**存储器管理（内存管理）**
   3. 对应的进程被处理机（cpu）处理----**处理机管理**
   4. 需要把摄像头分配给进程----**设备管理**

2. 作为用户和计算机硬件之间的接口
   1. **命令接口**：联机命令接口（交互式）、脱机命令接口（批处理命令接口，类似于*.bat文件）
   2. **程序接口**：由一组**系统调用**组成
   3. **GUI图形用户界面**：

3. 作为接近硬件的层次
   1. 实现对硬件及其的拓展

#### 1.1_2 操作系统的特征

1. **并发**：指两个或者多个事件在同一时间间隔内发生（宏观上同时发生，微观上交替发生）。区别于**并行**（指两个或多个事件同时发生）

   一个单核处理机（CPU）同一时刻只能执行一个程序

2. **共享：**资源共享，是指可供内存中多个并发进程共同使用

   1. 互斥共享方式：一个时间段只允许一个进程访问该资源。比如QQ，微信对于摄像头的使用
   2. 同时共享方式：一个时间段由多个进程“同时”进行访问。QQ，微信同时发送同一个文件

   ***并发和共享是充要条件**，是操作系统最基本的两个特征

3. **虚拟**：把一个物理上的实体变为若干个逻辑上的对应物。空分复用技术，时分复用技术

4. **异步**：由于资源有限，进程执行不是一贯到底的，而是走走停停

#### 1.1_3 操作系统的发展和分类

1. 手工操作阶段。人机速度矛盾
2. 批处理系统。内存中仅有一道程序运行
3. 多道批处理系统。不提供人机交互
4. 分时操作系统。解决了人机交互问题，不能解决紧急任务
5. 实时操作系统。能够响应紧急任务，及时性可靠性

#### 1.1_4 操作系统运行机制，体系结构

处理器的两种状态：

	* **用户态**：此时CPU只能执行非特权指令
	* **核心态**：特权指令、非特权指令都可执行

两种程序：

	* **内核程序**：运行在核心态（特权指令、非特权指令都可执行）
	* **应用程序**：运行在用户态（只能执行非特权指令）



操作系统的内核：

内核是计算机上配置的**底层软件**，是操作系统最基本最核心的部分

![img](/assets/img/blog/841.png)

**原子性**：运行时一气呵成，不可中断

内核可以分为：大内核（包含橙色部分，高性能，结构混乱），微内核（不包含橙色部分）

#### 1.1_5 中断和异常

本质：发生中断意味着需要操作系统接入，开展管理工作

1. 当中断发生时，CPU立即进入**核心态**
2. 当中断发生后，当前运行程序暂停，并由操作系统内核对中断进行处理（进入核心态）
3. 对于不同中断信号，会进行不同的处理



**用户态转为核心态，中断是唯一途径**

核心态转为用户态，只需要设置一个PSW（程序状态字）即可



中断的分类：

1. 内中断（信号来源于**CPU内部**，与**当前执行的指令有关**，也称为异常/例外/陷入）
   1. 自愿中断（trap）
   2. 强迫中断（abort）
2. 外中断（信号来源于**CPU外部**，与**当前执行的指令无关**，也称为狭义中断）
   1. 外设请求：如IO操作发出的中断信号
   2. 人工干预：用户强制停掉一个进程

#### 1.1_6 系统调用

应用程序通过**系统调用**请求操作系统的服务。系统中的各种共享资源都由操作系统统一掌管，因此在用户程序中，**凡是与资源有关**的操作（如存储分配、I/O操作、文件管理等），都必须通过系统调用的方式向操作系统提出服务请求，有操作系统代为完成。这样可以保证**系统的稳定性和安全性**，防止用户非法操作

系统调用的相关处理在**核心态**进行





### 二、进程

#### 2.1_1进程的定义、组成、组织方式、特征

程序：就是一个指令序列

进程：**程序段，数据段，PCB**（进程控制块，用来描述进程的各种信息）三部分组成了进程实体，简称为进程。

**PCB是进程存在的唯一标识！**，创建/撤销进程就是创建/撤销PCB

**进程是动态的**



进程控制块：

![进程控制块（PCB）](/assets/img/blog/2-1Q1011J630138.gif)



进程的组织方式：

1. 链接方式：执行指针；就绪队列指针；阻塞队列指针。
2. 索引方式：执行指针；就绪队列指针；阻塞队列指针。



进程特征：

1. 动态性。**最基本特征**
2. 并发行
3. 独立性。**进程是资源分配，接受调度的基本单位**
4. 异步性
5. 结构性

#### 2.1_2 进程的状态与转换

三种基本状态：

1. 运行态。每个核可以运行一个进程，双核可以同时运行两个进程
2. 就绪态。万事俱备，只欠CPU
3. 阻塞态
4. 创建态
5. 终止态



进程状态之间的转换

![进程状态转换与线程状态转换的区别_Horace Ho的博客-CSDN博客](/assets/img/blog/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ob3JhY2VoZS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70.png)



#### 2.1_3 进程控制

进程控制就是要实现进程状态之间的转换。

开/关中断指令的权限非常大，必须只允许在核心态下执行的特权指令

进程控制使用原语实现

过程：

1. 更新PCB信息
2. 将PCB插入合适的队列
3. 分配/回收资源





#### 2.1_4 进程通信

进程通信指的是进程之间的信息交换

进程是分配系统资源的单位，因此各进程的内存地址空间相互独立



方式一：**共享存储**

两个进程对共享空间的访问**必须是互斥**的

分为两种

1. 基于数据结构的共享
2. 基于存储区的共享

方式二：**管道通信**

1. 半双工通信
2. 互斥的
3. 管道写满，写进程阻塞；管道变空，读进程阻塞
4. 管道没写满，不能读；没读空，不能写
5. 只能有一个读进程（管道数据读完就抛弃了）

方式三：**消息传递**

进程间的数据交换以**格式化消息**为单位



#### 2.1_5 线程概念和多线程模式

线程是一种“轻量级进程”

**引入线程之后，<u>进程是资源分配的基本单位，线程是调度的基本单位</u>**



线程控制块（TCB）

切换同进程的线程，系统开销很小，不需要切换运行环境



分类：

1. 用户级线程：用户可以看到，操作系统看不到。
2. 内核级线程：需要在核心态下完成。操作系统能看到

**操作系统只“看得见”内核级线程，因此只有内核级线程才是处理机分配的单元**



多线程模型：

1. 多用户级线程对一个内核级线程。并发性差
2. 一对一：一个用户级线程映射到一个内核级线程。并发能力高
3. 多对多：n个用户级线程映射到m个内核级线程（n>=m）。克服了多对一并发性差的缺点，又克服了一对一模型中内核切换开销大的问题

#### 2.2_1处理机调度的概念、层次

**按照一定的算法选择一个进程**并将处理机分配给它运行



高级调度：作业调度

中级调度：内存调度

低级调度：进程调度，最基本的一种调度

![img](/assets/img/blog/100.jpeg)



#### 2.2_2 进程调度的时机、切换与过程、方式

需要进行进程调度和切换的情况：

1. 当前运行的程序主动放弃处理机
   1. 进程正常终止
   2. 发生异常终止
   3. 进程主动请求阻塞
2. 被动放弃
   1. 时间片用完
   2. 有更紧急的事要处理
   3. 有更高优先级的进程进入就绪队列

不能进行进程调度的情况：

1. 在处理中断的过程中
2. 进程在操作系统内核程序临界区。普通临界区是可以进行调度的，比如打印机
3. 原子操作过程中



**临界资源**：一个时间段内只允许一个进程使用的资源。各进程需要互斥地访问临界资源

**临界区**：访问临界资源的那段代码



进程调度方式：

1. 非剥夺调度方式
2. 剥夺调度方式。可以优先处理更紧急的进程



进程的切换：

1. 对原来运行进程各种数据的保存
2. 对新的进程各种数据的恢复



进程切换有代价，频繁的进程切换会影响运行效率



#### 2.2_3调度算法的评价指标

CPU利用率：忙碌的时间/总时间

系统吞吐量：单位时间内完成作业的数量

周转时间：作业完成时间-作业提交时间

等待时间：对于**进程**来说就是进程简历后等待被服务的时间之和；对于**作业**来说，不仅要考虑简历进程后的等待时间，还要加上作业在外存后备队列中的等待时间

响应时间：提交到首次响应所用的时间



#### 2.2_4 FCFS、SJF、HRRN调度算法

##### 1. 先来先服务FCFS

非抢占式算法

对长作业有利，对段作业不利。



##### 2. 短作业优先SJF（shortest job first）

时间最短的作业/进程优先得到服务

有两种：抢占式和非抢占式

对短作业有利，长作业不利

##### 3. 高响应比优先HRRN（highest response ratio next）

综合考虑等待时间和要求服务时间

响应比=（等待时间+要求服务时间）/要求服务时间 >=1



#### 2.2_5 时间片轮转、优先级、多级反馈队列



1. 时间片轮转（RR, Round-Robin）

   常用于分时操作系统

   如果时间片太大，则该算法退化为FCFS算法；时间片太小，导致进程切换太多

2. 优先级调度算法

   系统进程优先于用户进程

   前台进程优于后台进程

   

3. 多级反馈队列调度算法

综合了前面的所有算法优点

类似于去饭店吃饭，先给来个凉菜，再给来个热菜，最后上时间最长的汤

![在这里插入图片描述](/assets/img/blog/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lyeDQyMDkwOQ==,size_16,color_FFFFFF,t_70.png)

#### 2.3_1 进程同步、进程互斥

进程互斥四个部分：

1. 进入区：检查是否可以进入，若进入，需要上锁
2. 临界区：**访问临界资源的代码段**
3. 退出区：负责解锁
4. 剩余区

为了实现对临界资源的互斥访问，需要遵循一下原则：

1. 空闲让进
2. 忙则等待
3. 有限等待
4. 让权等待



#### 2.3_2 进程互斥的软件实现方法

1. 单标志法

![在这里插入图片描述](/assets/img/blog/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N0YXJ0ZXJfX19fXw==,size_16,color_FFFFFF,t_70-20210306215651748.png)

2. 双标志先检查法

3. 双标志后检查法
4. Peterson算法



#### 2.3_3 进程互斥的硬件实现方法

1. 中断屏蔽方法：开/关中断指令
2. TestAndSet指令
3. Swap指令

#### 2.3_4 信号量机制

信号量其实是一个变量（可以是一个整数，也可以是更复杂的记录型变量），**表示系统中某种资源的数量**，比如打印机数量等 



一对原语：wait(S)和signal(S)（也可以写为P(S)和V(S)）

两种信号量：

1. 整形信号量
2. 记录型信号量

#### 2.3_5 信号量实现进程互斥、同步、前驱关系

1. 信号量实现互斥

   不同的临界资源需要设置不同的互斥信号量

   **信号量初始值设为1**

2. 信号量机制实现进程同步：

![img](/assets/img/blog/1358881-20190915135612260-1362223675.png)

3. 信号量机制实现前驱操作

   ![img](/assets/img/blog/1358881-20190915140319276-1184668052.png)