---
layout: post
title: 计算机网络
tags: [network]
comments: true
thumbnail-img: "/assets/img/blog/LinuxPenguin.png"
share-img: ""
typora-copy-images-to: ../assets/img/blog
typora-root-url: ../assets/img/blog
---

[toc]



### 一、计算机网络



#### 1.概念及分类

**概念：**计算机网络是一个将分散的，具有独立功能的**计算机系统**，通过**通信设备**和**线路**连接起来，用功能完善的**软件**实现资源共享和信息传递的系统

通信设备+线路+软件；相互之间互通，自治的计算机集合。

**功能：**1.数据通信；2.资源共享；3.分布式处理；4.可靠性；5.负载均衡。。。



**分类：**

分布范围分：广域网 城域网 局域网 个人区域网

使用者份：公用网 专用网

拓扑结构：总线型 星型 环形 网状型（目前的广域网采用网状型）

传输技术：广播式网络 点对点网络





#### 2.标准化工作

**标准分类：**1.法定标准，如osi；2.事实标准TCP/IP



#### 3.速率相关性能指标



**速率：**即数据率/数据传输率/bit率；单位是b/s kb/s Mb/s Gb/s Tb/s. 每一个进率为1000

> ps: 在表示速率的时候我们一般用小写的kb，表示存储容量的时候一般用大写的KB
>
> 1Byte = 8bit 一般用Byte表示存储容量，而不用bit
>
> 1KB=2^10B =1024B=1024*8bit
>
> 1MB=2^10KB=1024 KB
>
> 1GB=2^10MB
>
> 1TB=2^10GB



**带宽：**原本只某个信号具有的频带宽度，即最高频率和最低频率之差，单位是Hz。在计算机网络中，**带宽**指的是网络的通信线路传送数据的能力，通常指单位时间内从网络中的某一点到另一点所能通过的**“最高数据率”**。单位是bit/s  kb/s Mb/s Gb/s





**吞吐量：**单位时间内通过某个网络（信道或者接口）的数据量。单位bit/s  kb/s Mb/s Gb/s





#### 4.时延，时延带宽积，RTT，利用率



**时延**：数据从网络的一段传送到另一端所需的时间。包括发送时延，传播时延，排队时延，处理时延。总的时延是所有时延的总和

**时延带宽积**=传播时延 * 带宽。可以理解为在链路上存储的数据比特

**往返时延RTT**：从发送方发送数据开始，到发送方收到接收方的确认，总共经历的时延。 平时的ping就是这样子

**利用率**：分为信道利用率（有数据通过时间 有/无数据通过总共的时间）和网络利用率（信道利用率的加权平均）



#### 5.分层结构、协议、接口、**服务**

![image-20210302191711251](/assets/img/blog/image-20210302191711251.png)

对等层之间有协议

下层只能为上层提供服务

只有相邻的层才有接口





#### 6.体系结构参考模型

为了解决计算机网络复杂的大问题--分层网络

计算机网络分层接口：

​	**6.1** 7层OSI参考模型（法定标准）

* **应用层(7层)**:所有能和用户产生网络流量的程序，比如FTP SMTP HTTP 
* **表示层(6层)**:  用于处理在两个通信系统中交换信息的表示方式（语法和语义），功能1，数据格式变换；功能二，数据加密解密；功能3，数据压缩和恢复           
* **会话层(5层)**:向表示层实体/用户进程提供**建立连接**并且有序的**传输数据**
* **传输层(4层)**: 负责主机中两个进程的通信，即**端到端通信**。TCP/UDP
* **网络层(3层)**: 主要是负责把分组从源端传到目的端
* **数据链路层(2层)：**把网络层传下来的数据报**组装成帧**
* **物理层(1层):**傻瓜层，在物理媒体上实现比特流透明传输

可以用一句话总结（1层到7层）--**物联网叔会使用**

1-3层是通信子网负责**数据通信**，5-7层是资源子网负责**数据处理**



​	**6.2** 4层TCP/IP参考模型（事实标准）





> OSI与TCP/IP相同点：
>
> 1. 都分层
> 2. 基于独立的协议栈的概念
> 3. 可以实现异构网络互联



6.3 5层参考模型

综合了OSI和TCP/IP的有点





### 二、物理层

#### 1.物理层基本概念

物理层解决如何在各种计算机的传输媒介上传输**数据比特流**，而不是指具体的传输媒介

主要任务：确定接口的一些特性---定义标准

1. 机械特性
2. 电气特性
3. 功能特性
4. 规程特性



#### 2. 数据通信基础知识

典型的数据通信模型：

![2.1.2数据通信基础知识_Reast1nPeace的博客-CSDN博客](https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vcmVhc3QxbnBlYWNlL3BpY3R1cmUvcmF3L21hc3Rlci8lRTglQUUlQTElRTclQUUlOTclRTYlOUMlQkElRTclQkQlOTElRTclQkIlOUMvUVEyMDIwMDQxOS0xNjI5MjZAMnguanBn?x-oss-process=image/format,png)

**Related terminology：**

数据：传送信息的实体

信号：数据的电气/电磁的表现，是数据在传输过程中的**存在形式**

​			数字信号

​			模拟信号

信源：产生/发送数据的源头

信宿：接受数据的终点

信道：信号的传输媒介





**三种通信方式**：单工（电视），半双工（对讲机），双工（微信）

**两种数据传输方式：**串行传输（速度慢，费用低，适合远距离），并行传输（速度快，费用高，适合近距离，用于计算机内部）





#### 3.码元，波特，速率，带宽



> 码元

是指一个**固定时常的信号波形**。比如01010101（对应一个方波信号），其中的每一位bit都是一个二进制码元，每一位的时常称为**码元宽度**。

> 速率

数据的传输速率

* 码元传输速率：1s传输多少个**码元**。单位是**波特**（Baud），1Baud = 1码元/s
* 信息传输速率：1s传输多少个比特。eg：一个码元有n bit信息量，则M Baud = M*nbit / s

> 带宽

单位时间内从网络中一点到另一点所能通过的最高数据率



#### 4.奈氏准则和香农定理

影响信号传输失真程度的因素：1.码元传输速率；2.传输距离；3.噪声；4.传输媒体质量

码元串扰：信号频率太快，接受端无法区别不同的码元。

> 内忧

**奈氏准则：**在理想低通条件（无噪声，带宽受限）下，为了避免码元串扰，极限码元传输速率为2W Baud， W是信道的带宽，单位Hz

上述准则只限制了码元的传输速率，因此可以考虑让每个码元携带更多的bit位，从而提高信息传输速率



> 外患

**香农定理：**在带宽受限且**有噪声**的信道中，信息的传输速率有上限值。

信道的极限数据传输速率=W*log2(1+S/N) bit/s



#### 5.编码与调制

> 信道分类：

1. 按传输信号可以分为：模拟信道，数字信道
2. 按传输介质可以分为：无线信道，有线信道



**基带信号**：将数字信号1 0直接用两种电压表示，然后送到**数字信道**上去传输

**宽带信号**：将基带信号进行调制后形成模拟信号，然后送到**模拟信道**上进行



编码：数据到数字信号

调制：数据到模拟信号



| 数字数据编码为数字信号                     | 数字数据编码为模拟信号                    |
| ------------------------------------------ | ----------------------------------------- |
| 1. 非归零编码 2.归零编码 3.曼彻斯特编码... | 1.调幅 2.调频 3.调相 4.调幅 + 调相（QAM） |



#### 6.传输介质及分类

传输媒体并不是物理层，而是处于物理层下面。是实际存在的物体，比如铜线，光线等



导向性传输介质

* 双绞线
* 同轴电缆：抗干扰性能好，价格高
* 光纤：损耗小，抗电磁干扰，体积小

非导向行传输介质

* 无线电波：所有方向传播
* 微波：固定方向传播，频率较高，数据率较高。eg:卫星通信，地面微波中继站
* 红外线，激光：固定方向传播



#### 7.物理层设备

1.中继器

> 对信号进行再生和还原

2.集线器（多口中继器）

> 对信号进行再生和放大





### 三、数据链路层



#### 1.链路层的功能

**Key words**

**节点：**主机、路由器

**链路：**网络中两个节点之间的**物理通道**，链路的传输介质主要有双绞线，光纤和微波

**数据链路：**网络中两个节点之间的**逻辑通道**

帧：链路层的协议数据单元，封装网络层数据报



数据链路层在物理层提供服务的基础上**向网络层提供服务**，主要作用就是**加强物理层传输原始比特流的功能**，将物理层提供的可能出错的物理连接改造成为<u>逻辑上无差错的数据链路</u>. Eg： 想象网络层就是一个boss，数据链路层就是小蜜，物理层就是一个传送文件的快递员，他可能会丢失传送的文件，所以小蜜就在文件上编号，这样即使快递员丢了，也能找回文件

功能1: 为网络层提供服务。无确认无连接服务，有确认无连接服务，有确认面向连接服务。

功能2:链路管理，即连接的建立，维持，释放

功能3:组帧

功能4:流量控制

功能5:差错控制



#### 2.封装成帧，透明传输

**封装成帧**就是在一段数据的前后添加首部和尾部，这样就构成了一个帧。

![数据链路层功能——封装成帧&&差错控制- 简书](/assets/img/blog/images.png)

首部和尾部包含许多的控制信息，他们有一个重要的作用就是，帧定界

补充知识：**MTU（Maximum Transmission Unit）**



**透明传输：**不管传数据是什么样的比特组合（比如和控制信息一样），都应当能在链路上传送

方法：

1. 字符计数法。容易出现灾难性后果
2. 字符填充法。包含SOH和EOT。如果数据中EOT，则可以在数据中的EOT前边添加一个转义字符ESC。接受端再将转义字符ESC去掉
3. 零比特填充法。首部和尾部都是01111110，数据中如果有多于5个1，就在后边添加0。也就是 5 “1” 1 “0”的规则
4. 违规编码法。可以用曼彻斯特编码中连续的高或者低来定义起始和终止



**差错从何而来**

来源：

全局性随机热噪声

局部性的随机冲击噪声

差错分为：

> 位错：比特位出错。0变为1，或者1变为0
>
> 帧错：1.丢失帧；2. 重复帧；3. 失序（1-2-3变成了1-3-2）





数据链路层的差错控制，主要是解决比特错误：

1.检错编码：奇偶校验码，循环冗余码CRC

2.纠错编码：海明码



**注意：**数据链路层的编码和物理层的编码不同，物理层的编码是把<u>单个bit</u>位变为了高低电平，而数据链路层是针对的<u>一组比特</u>



> 奇偶校验码
>
> n-1个数据源，添加上1位校验元，是1的个数为奇数/偶数（奇校验/偶校验）
>
> 缺点：只能检测**奇数个比特**错误，检错能力只有50%

> CRC循环冗余码
>
> eg：5 / 2 = 2 ... 1, 最后传输的是5+1 = 6，然后接受端收到6之后，6 / 2 = 3 ... 0, 余数为0，说明传输无差错



> 海明码
>
> 发现双比特错误，纠正单比特错误
>
> 海明不等式，比较复杂，具体用到时可以查看百度



#### 3.链路层流量控制和可靠传输机制



较高的**发送速度**和较低的**接受能力**不匹配，会造成传输出错，所以流量控制也是数据链路层的一项重要工作

数据链路层的流量控制是<u>点到点</u>的，而传输层的流量控制是<u>端到端</u>的

eg：主人给猫喂猫粮，如果猫没吃饱就会把空的碗送出来，主人就会再次投喂，否则，碗就不会被送出来。这就是数据链路层的数据确认帧

**可靠传输：**发送端发啥，接受端收啥



**流量控制方法：**

1. 停止-等待协议（是一种特殊的滑动窗口协议，发送窗口和接受窗口均为1）

   每次发送完一个帧之后就停止，等待对方的确认，收到确认之后再发送下一个帧



2. 滑动窗口协议

   2.1 后退N帧协议（GBN）（发送窗口>1,接受窗口=1）

   2.2 选择重传协议(SR)（发送窗口>1,接受窗口>1）

   

##### 3.1停止等待协议

why？

1.解决丢包问题；2.实现流量控制



如果出现丢包，超时计时器超时后，会重新发送1帧，超时时常应该比帧传输往返时延更长一些

如果确认帧（ACK）丢失，那么会重新发送一帧，直到能够收到确认帧为止。接受方收到重复帧就会丢弃

如果ACK迟到，发送方收到之前帧的确认帧，直接丢弃



##### 3.2后退N帧协议（GBN）

**发送窗口可以多个，接受窗口只有一个**

![计算机网络教程-传输层（十二）传输层基础协议：回退N帧协议GBN - 程序员大本营](https://www.pianshen.com/images/703/c7acdb2d5fc1a4ab64cf854de2291767.png)

> 滑动窗口长度设置：

窗口过大的话会导致接受方无法区别新帧和旧帧



接受方只按顺序接受帧；确认序列号最大的，按序到达的帧

GBN中对n号帧的确认<u>**采用累积确认**</u>的方式，表明接受方已经收到了n号帧和它之前的全部帧



**优点**：连续发送数据帧而提高了信道利用率

**缺点**：重传时必须把原来已经正确传送的数据帧重新传送，使传送效率降低

##### 3.3选择重传协议SR（selective repeat）

![选择重传协议（SR）_HWP-CSDN博客](https://img-blog.csdnimg.cn/20200319143243996.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80Mjg1OTI4MA==,size_16,color_FFFFFF,t_70)



接受方：来者不拒（窗口内的帧，如果是窗口序号外（小于窗口下届的帧），直接返回一个ack）

滑动窗口长度设置：

发送窗口最好等于接受窗口，大了会溢出，小了没意义。窗口大小应该为2^(n-1)



#### 4.ALOHA协议（不听别人，就说）

分为：

*  纯aloha协议不监听信道，不按时间槽发送，随机发送。就是**想发就发**
* 时隙aloha协议中:固定时间片的开始才能发送

![3.5.1信道划分介质访问控制_Reast1nPeace的博客-CSDN博客](https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vcmVhc3QxbnBlYWNlL3BpY3R1cmUvcmF3L21hc3Rlci8lRTglQUUlQTElRTclQUUlOTclRTYlOUMlQkElRTclQkQlOTElRTclQkIlOUMvUVEyMDIwMDQyMC0yMzIzMjNAMnguanBn?x-oss-process=image/format,png)

随机访问介质控制访问：所有用户可以随机发送信息，占用全部带宽。不协调，容易发生冲突



#### 5.CSMA协议（载波监听多路访问协议 carrier sense multiple access）（先听再说）

CS：载波监听。 每个站在发送数据前要检测一下总线上是否有其他计算机在发送数据

MA：多点介入，许多计算机以多点接入的方式连接到一根总线上

协议思想：发送帧之前，监听信道



1-坚持CSMA：空闲则直接传输，不必等待。忙则一直监听，直到空闲马上传输

非坚持CSMA：空闲则直接传输，不必等待。忙则等待一个随机时间再进行监听

p-坚持CSMA：空闲则以p概率直接传输，不必等待；概率1-p等待到下一个时间槽才传输。忙则等待一个随机的时间在进行监听



#### 6.CSMA/CD协议（carrier sense multiple access/collision detection）（先听再说，边听边说）

CD：碰撞检测，**边发送边监听信道是否冲突**



why 先监听在发送，还会冲突？因为电磁波在总线上传播有时延

争用期为2t，只要经过2t时间还没有检测出碰撞，就可以肯定这次发送不会发生碰撞。（t为单程端到端时延）

解决方法：截断二进制指数规避算法



**最小帧长问题：**

帧的的传输时延至少要两倍于信号在总线中的单程时延。否则会出现，信号已经发完了才检测到发生碰撞 

ps：

以太网规定最帧长为**64B**，凡小于64B的都是由于冲突而异常终止的无效帧。所以小于64B，会填充到64B再传送 



#### 7.CSMA/CA协议（carrier sense multiple access/collision avoidance）

载波监听多点接入/碰撞避免



> 为什么有这个协议：

主要是用于无线网，而CSMA/CD主要用于以太网（有线）。因为无线网络无法做到碰撞检测，不止一个方向。而且有隐蔽站的问题。

发送数据钱，先检测信道是否空闲。空闲则发送RTS（request to send），接受端收到RTS，响应CTS(clear to send)





#### 8.局域网

局域网简称LAN（Local area network），是指在某一区域内多台计算机组成的计算机组，使用**广播信道**



> 特点：
>
> 1. 覆盖的地理范围较小
> 2. 使用专门铺设的传输介质（双绞线，同轴电缆）进行联网，数据传输速率高（10Mb/s~10Gb/s）
> 3. 通信时延低，误码率低
> 4. 各站为平等关系
> 5. 多采用分布式控制和广播式通信



决定局域网的主要要素是：**<u>网络拓扑，传输介质，介质访问控制方法</u>**



局域网的网络拓扑结构：

1. 星型拓扑，有单点故障问题
2. 总线型拓扑，比较好，用的也最多
3. 环形拓扑，有单点故障问题
4. 树状拓扑，有单点故障问题





局域网介质访问控制方法：

1. CSMA/CD
2. 令牌总线：只有令牌持有者才能控制总线
3. 令牌环

局域网分类：

1. 以太网 IEEE802.3
2. 令牌环网 IEEE802.5
3. FDDI  IEEE802.8
4. ATM网 
5. **无线局域网（WLAN wireless local area network）：采用IEEE 802.11标准**



IEEE802标准：在1980年2月制定的



**局域网链路层的两个子层：**

逻辑链路控制子层（LLC子层）、介质访问控制子层（MAC子层）





##### 8.1 以太网

以太网使用CSMA/CD介质访问控制方法

1. 造价低廉
2. 应用最广泛
3. 满足网络速率要求10Mb/s~10Gb/s



以太网提供**无连接**，**不可靠**的服务



以太网传输介质发展：粗同轴电缆，细同轴电缆，双绞线+集线器



以太网拓扑：**逻辑上总线型，物理上星型**

MAC地址常用6个16进制数来表示：比如02-60-8c-e4-b1-21



**以太网MAC帧**：（数据报长度下限46是因为最小帧长度64-6-6-2-4得到的，1500是因为早期的RAM大小有限）

![TCP/IP协议族核心协议数据包长度探究| DaDo Wang' Blog](https://blog.wdado.com/2019/07/13/TCP-IP%E5%8D%8F%E8%AE%AE%E6%97%8F%E6%A0%B8%E5%BF%83%E5%8D%8F%E8%AE%AE%E9%95%BF%E5%BA%A6%E6%8E%A2%E7%A9%B6/%E4%BB%A5%E5%A4%AA%E7%BD%91V2%E4%B8%ADMAC%E5%B8%A7%E6%A0%BC%E5%BC%8F.jpg)



##### 8.2 无线局域网

有固定基础设施无线局域网。基础服务集，扩展的服务集

无固定基础设施无线局域网的自组织网络





#### 9.ppp协议和HDLC协议

广域网（WAN，wide area network），通常跨接很大的物理范围，所覆盖的范围从几十公里到几千公里。 如因特网，是世界范围最大的广域网



> **ppp协议**（point to point protocol）是目前使用最广泛的数据链路层协议，用户使用拨号电话接入因特网是一般都使用ppp协议。



ppp是**面向字节**的协议



> **HDLC协议**（high-level data link control,高级数据链路控制），**面向比特**的数据链路层协议



ppp和hdlc相同：均只支持**<u>全双工链路</u>**，都可以实现透明传输。都可以实现差错检测，但不纠正错误

ppp和hdlc异同：ppp面向字符，hdlc面向比特



#### 10.链路层设备

链路层扩展以太网：可以通过网桥和交换机来扩展



网桥：根据mac帧的目的地址对阵进行转发和过滤。

网桥优点：1. 过滤通信量；2.扩大了物理范围；3.提高了可靠性

网段：一般指一个计算机网络中使用同一物理层设备（传输介质，中继器，集线器）能够直接通信的那一部分

![吐血码万字长文搞懂了数据链路层- 小黑电脑](https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vbGVpeXVqaWEvY3Nkbi9yYXcvbWFzdGVyLyVFNyVCRCU5MSVFNiVBMSVBNS5wbmc?x-oss-process=image/format,png)

网桥分为：

1. 透明网桥：透明是指以太网上的站点并不知道所发送的帧经过那几个网桥，是一种即插即用的设备--具有自学习能力
2. 源路由网桥：发送帧是，把详细的最佳路由信息放在帧的首部



网桥接端口太少，所以就发展出交换机。

多接口网桥--以太网交换机

**交换机类型：**

1. **直通式交换机**：查完目的地址之后就立即转发。延迟小，但是可靠性差，不支持不同速率的端口交换
2. **存储转发式交换机**：将帧放入高速缓存，并检查是否正确，正确则转发，否则丢弃。延迟大，可靠性高，支持不同速率端口的交换。（目前常用的类型）

![8. 网络层设备：路由器- Computer Network](https://gblobscdn.gitbook.com/assets%2F-M8zvqNNVZctOHx6v8No%2F-ME3magMx6taYZhZPGd3%2F-ME3s8_QgLHdlE0UgHK_%2Fimage.png?alt=media&token=180616e2-4f47-419b-899e-69ca19416809)