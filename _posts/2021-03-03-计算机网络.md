---
layout: post
title: 计算机网络
tags: [network]
comments: true
thumbnail-img: "/assets/img/blog/LinuxPenguin.png"
share-img: ""
typora-copy-images-to: ../assets/img/blog
typora-root-url: ../assets/img/blog
---

[toc]



### 一、计算机网络



#### 1.概念及分类

**概念：**计算机网络是一个将分散的，具有独立功能的**计算机系统**，通过**通信设备**和**线路**连接起来，用功能完善的**软件**实现资源共享和信息传递的系统

通信设备+线路+软件；相互之间互通，自治的计算机集合。

**功能：**1.数据通信；2.资源共享；3.分布式处理；4.可靠性；5.负载均衡。。。



**分类：**

分布范围分：广域网 城域网 局域网 个人区域网

使用者份：公用网 专用网

拓扑结构：总线型 星型 环形 网状型（目前的广域网采用网状型）

传输技术：广播式网络 点对点网络





#### 2.标准化工作

**标准分类：**1.法定标准，如osi；2.事实标准TCP/IP



#### 3.速率相关性能指标



**速率：**即数据率/数据传输率/bit率；单位是b/s kb/s Mb/s Gb/s Tb/s. 每一个进率为1000

> ps: 在表示速率的时候我们一般用小写的kb，表示存储容量的时候一般用大写的KB
>
> 1Byte = 8bit 一般用Byte表示存储容量，而不用bit
>
> 1KB=2^10B =1024B=1024*8bit
>
> 1MB=2^10KB=1024 KB
>
> 1GB=2^10MB
>
> 1TB=2^10GB



**带宽：**原本只某个信号具有的频带宽度，即最高频率和最低频率之差，单位是Hz。在计算机网络中，**带宽**指的是网络的通信线路传送数据的能力，通常指单位时间内从网络中的某一点到另一点所能通过的**“最高数据率”**。单位是bit/s  kb/s Mb/s Gb/s





**吞吐量：**单位时间内通过某个网络（信道或者接口）的数据量。单位bit/s  kb/s Mb/s Gb/s





#### 4.时延，时延带宽积，RTT，利用率



**时延**：数据从网络的一段传送到另一端所需的时间。包括发送时延，传播时延，排队时延，处理时延。总的时延是所有时延的总和

**时延带宽积**=传播时延 * 带宽。可以理解为在链路上存储的数据比特

**往返时延RTT**：从发送方发送数据开始，到发送方收到接收方的确认，总共经历的时延。 平时的ping就是这样子

**利用率**：分为信道利用率（有数据通过时间 有/无数据通过总共的时间）和网络利用率（信道利用率的加权平均）



#### 5.分层结构、协议、接口、**服务**

![image-20210302191711251](/assets/img/blog/image-20210302191711251.png)

对等层之间有协议

下层只能为上层提供服务

只有相邻的层才有接口





#### 6.体系结构参考模型

为了解决计算机网络复杂的大问题--分层网络

计算机网络分层接口：

​	**6.1** 7层OSI参考模型（法定标准）

* **应用层(7层)**:所有能和用户产生网络流量的程序，比如FTP SMTP HTTP 
* **表示层(6层)**:  用于处理在两个通信系统中交换信息的表示方式（语法和语义），功能1，数据格式变换；功能二，数据加密解密；功能3，数据压缩和恢复           
* **会话层(5层)**:向表示层实体/用户进程提供**建立连接**并且有序的**传输数据**
* **传输层(4层)**: 负责主机中两个进程的通信，即**端到端通信**。TCP/UDP
* **网络层(3层)**: 主要是负责把分组从源端传到目的端
* **数据链路层(2层)：**把网络层传下来的数据报**组装成帧**
* **物理层(1层):**傻瓜层，在物理媒体上实现比特流透明传输

可以用一句话总结（1层到7层）--**物联网叔会使用**

1-3层是通信子网负责**数据通信**，5-7层是资源子网负责**数据处理**



​	**6.2** 4层TCP/IP参考模型（事实标准）





> OSI与TCP/IP相同点：
>
> 1. 都分层
> 2. 基于独立的协议栈的概念
> 3. 可以实现异构网络互联



6.3 5层参考模型

综合了OSI和TCP/IP的有点





### 二、物理层

#### 1.物理层基本概念

物理层解决如何在各种计算机的传输媒介上传输**数据比特流**，而不是指具体的传输媒介

主要任务：确定接口的一些特性---定义标准

1. 机械特性
2. 电气特性
3. 功能特性
4. 规程特性



#### 2. 数据通信基础知识

典型的数据通信模型：

![2.1.2数据通信基础知识_Reast1nPeace的博客-CSDN博客](https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vcmVhc3QxbnBlYWNlL3BpY3R1cmUvcmF3L21hc3Rlci8lRTglQUUlQTElRTclQUUlOTclRTYlOUMlQkElRTclQkQlOTElRTclQkIlOUMvUVEyMDIwMDQxOS0xNjI5MjZAMnguanBn?x-oss-process=image/format,png)

**Related terminology：**

数据：传送信息的实体

信号：数据的电气/电磁的表现，是数据在传输过程中的**存在形式**

​			数字信号

​			模拟信号

信源：产生/发送数据的源头

信宿：接受数据的终点

信道：信号的传输媒介





**三种通信方式**：单工（电视），半双工（对讲机），双工（微信）

**两种数据传输方式：**串行传输（速度慢，费用低，适合远距离），并行传输（速度快，费用高，适合近距离，用于计算机内部）





#### 3.码元，波特，速率，带宽



> 码元

是指一个**固定时常的信号波形**。比如01010101（对应一个方波信号），其中的每一位bit都是一个二进制码元，每一位的时常称为**码元宽度**。

> 速率

数据的传输速率

* 码元传输速率：1s传输多少个**码元**。单位是**波特**（Baud），1Baud = 1码元/s
* 信息传输速率：1s传输多少个比特。eg：一个码元有n bit信息量，则M Baud = M*nbit / s

> 带宽

单位时间内从网络中一点到另一点所能通过的最高数据率



#### 4.奈氏准则和香农定理

影响信号传输失真程度的因素：1.码元传输速率；2.传输距离；3.噪声；4.传输媒体质量

码元串扰：信号频率太快，接受端无法区别不同的码元。

> 内忧

**奈氏准则：**在理想低通条件（无噪声，带宽受限）下，为了避免码元串扰，极限码元传输速率为2W Baud， W是信道的带宽，单位Hz

上述准则只限制了码元的传输速率，因此可以考虑让每个码元携带更多的bit位，从而提高信息传输速率



> 外患

**香农定理：**在带宽受限且**有噪声**的信道中，信息的传输速率有上限值。

信道的极限数据传输速率=W*log2(1+S/N) bit/s



#### 5.编码与调制

> 信道分类：

1. 按传输信号可以分为：模拟信道，数字信道
2. 按传输介质可以分为：无线信道，有线信道



**基带信号**：将数字信号1 0直接用两种电压表示，然后送到**数字信道**上去传输

**宽带信号**：将基带信号进行调制后形成模拟信号，然后送到**模拟信道**上进行



编码：数据到数字信号

调制：数据到模拟信号



| 数字数据编码为数字信号                     | 数字数据编码为模拟信号                    |
| ------------------------------------------ | ----------------------------------------- |
| 1. 非归零编码 2.归零编码 3.曼彻斯特编码... | 1.调幅 2.调频 3.调相 4.调幅 + 调相（QAM） |



#### 6.传输介质及分类

传输媒体并不是物理层，而是处于物理层下面。是实际存在的物体，比如铜线，光线等



导向性传输介质

* 双绞线
* 同轴电缆：抗干扰性能好，价格高
* 光纤：损耗小，抗电磁干扰，体积小

非导向行传输介质

* 无线电波：所有方向传播
* 微波：固定方向传播，频率较高，数据率较高。eg:卫星通信，地面微波中继站
* 红外线，激光：固定方向传播



#### 7.物理层设备

1.中继器

> 对信号进行再生和还原

2.集线器（多口中继器）

> 对信号进行再生和放大





### 三、数据链路层



#### 1.链路层的功能

**Key words**

**节点：**主机、路由器

**链路：**网络中两个节点之间的**物理通道**，链路的传输介质主要有双绞线，光纤和微波

**数据链路：**网络中两个节点之间的**逻辑通道**

帧：链路层的协议数据单元，封装网络层数据报



数据链路层在物理层提供服务的基础上**向网络层提供服务**，主要作用就是**加强物理层传输原始比特流的功能**，将物理层提供的可能出错的物理连接改造成为<u>逻辑上无差错的数据链路</u>. Eg： 想象网络层就是一个boss，数据链路层就是小蜜，物理层就是一个传送文件的快递员，他可能会丢失传送的文件，所以小蜜就在文件上编号，这样即使快递员丢了，也能找回文件

功能1: 为网络层提供服务。无确认无连接服务，有确认无连接服务，有确认面向连接服务。

功能2:链路管理，即连接的建立，维持，释放

功能3:组帧

功能4:流量控制

功能5:差错控制



#### 2.封装成帧，透明传输

**封装成帧**就是在一段数据的前后添加首部和尾部，这样就构成了一个帧。

![数据链路层功能——封装成帧&&差错控制- 简书](/assets/img/blog/images.png)

首部和尾部包含许多的控制信息，他们有一个重要的作用就是，帧定界

补充知识：**MTU（Maximum Transmission Unit）**



**透明传输：**不管传数据是什么样的比特组合（比如和控制信息一样），都应当能在链路上传送

方法：

1. 字符计数法。容易出现灾难性后果
2. 字符填充法。包含SOH和EOT。如果数据中EOT，则可以在数据中的EOT前边添加一个转义字符ESC。接受端再将转义字符ESC去掉
3. 零比特填充法。首部和尾部都是01111110，数据中如果有多于5个1，就在后边添加0。也就是 5 “1” 1 “0”的规则
4. 违规编码法。可以用曼彻斯特编码中连续的高或者低来定义起始和终止



**差错从何而来**

来源：

全局性随机热噪声

局部性的随机冲击噪声

差错分为：

> 位错：比特位出错。0变为1，或者1变为0
>
> 帧错：1.丢失帧；2. 重复帧；3. 失序（1-2-3变成了1-3-2）





数据链路层的差错控制，主要是解决比特错误：

1.检错编码：奇偶校验码，循环冗余码CRC

2.纠错编码：海明码



**注意：**数据链路层的编码和物理层的编码不同，物理层的编码是把<u>单个bit</u>位变为了高低电平，而数据链路层是针对的<u>一组比特</u>



> 奇偶校验码
>
> n-1个数据源，添加上1位校验元，是1的个数为奇数/偶数（奇校验/偶校验）
>
> 缺点：只能检测**奇数个比特**错误，检错能力只有50%

> CRC循环冗余码
>
> eg：5 / 2 = 2 ... 1, 最后传输的是5+1 = 6，然后接受端收到6之后，6 / 2 = 3 ... 0, 余数为0，说明传输无差错



> 海明码
>
> 发现双比特错误，纠正单比特错误
>
> 海明不等式，比较复杂，具体用到时可以查看百度



#### 3.链路层流量控制和可靠传输机制



较高的**发送速度**和较低的**接受能力**不匹配，会造成传输出错，所以流量控制也是数据链路层的一项重要工作

数据链路层的流量控制是<u>点到点</u>的，而传输层的流量控制是<u>端到端</u>的

eg：主人给猫喂猫粮，如果猫没吃饱就会把空的碗送出来，主人就会再次投喂，否则，碗就不会被送出来。这就是数据链路层的数据确认帧

**可靠传输：**发送端发啥，接受端收啥



**流量控制方法：**

1. 停止-等待协议（是一种特殊的滑动窗口协议，发送窗口和接受窗口均为1）

   每次发送完一个帧之后就停止，等待对方的确认，收到确认之后再发送下一个帧



2. 滑动窗口协议

   2.1 后退N帧协议（GBN）（发送窗口>1,接受窗口=1）

   2.2 选择重传协议(SR)（发送窗口>1,接受窗口>1）

   

##### 3.1停止等待协议

why？

1.解决丢包问题；2.实现流量控制



如果出现丢包，超时计时器超时后，会重新发送1帧，超时时常应该比帧传输往返时延更长一些

如果确认帧（ACK）丢失，那么会重新发送一帧，直到能够收到确认帧为止。接受方收到重复帧就会丢弃

如果ACK迟到，发送方收到之前帧的确认帧，直接丢弃



##### 3.2后退N帧协议（GBN）

**发送窗口可以多个，接受窗口只有一个**

![计算机网络教程-传输层（十二）传输层基础协议：回退N帧协议GBN - 程序员大本营](https://www.pianshen.com/images/703/c7acdb2d5fc1a4ab64cf854de2291767.png)

> 滑动窗口长度设置：

窗口过大的话会导致接受方无法区别新帧和旧帧



接受方只按顺序接受帧；确认序列号最大的，按序到达的帧

GBN中对n号帧的确认<u>**采用累积确认**</u>的方式，表明接受方已经收到了n号帧和它之前的全部帧



**优点**：连续发送数据帧而提高了信道利用率

**缺点**：重传时必须把原来已经正确传送的数据帧重新传送，使传送效率降低

##### 3.3选择重传协议SR（selective repeat）

![选择重传协议（SR）_HWP-CSDN博客](https://img-blog.csdnimg.cn/20200319143243996.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80Mjg1OTI4MA==,size_16,color_FFFFFF,t_70)



接受方：来者不拒（窗口内的帧，如果是窗口序号外（小于窗口下届的帧），直接返回一个ack）

滑动窗口长度设置：

发送窗口最好等于接受窗口，大了会溢出，小了没意义。窗口大小应该为2^(n-1)



#### 4.ALOHA协议（不听别人，就说）

分为：

*  纯aloha协议不监听信道，不按时间槽发送，随机发送。就是**想发就发**
* 时隙aloha协议中:固定时间片的开始才能发送

![3.5.1信道划分介质访问控制_Reast1nPeace的博客-CSDN博客](https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vcmVhc3QxbnBlYWNlL3BpY3R1cmUvcmF3L21hc3Rlci8lRTglQUUlQTElRTclQUUlOTclRTYlOUMlQkElRTclQkQlOTElRTclQkIlOUMvUVEyMDIwMDQyMC0yMzIzMjNAMnguanBn?x-oss-process=image/format,png)

随机访问介质控制访问：所有用户可以随机发送信息，占用全部带宽。不协调，容易发生冲突



#### 5.CSMA协议（载波监听多路访问协议 carrier sense multiple access）（先听再说）

CS：载波监听。 每个站在发送数据前要检测一下总线上是否有其他计算机在发送数据

MA：多点介入，许多计算机以多点接入的方式连接到一根总线上

协议思想：发送帧之前，监听信道



1-坚持CSMA：空闲则直接传输，不必等待。忙则一直监听，直到空闲马上传输

非坚持CSMA：空闲则直接传输，不必等待。忙则等待一个随机时间再进行监听

p-坚持CSMA：空闲则以p概率直接传输，不必等待；概率1-p等待到下一个时间槽才传输。忙则等待一个随机的时间在进行监听



#### 6.CSMA/CD协议（carrier sense multiple access/collision detection）（先听再说，边听边说）

CD：碰撞检测，**边发送边监听信道是否冲突**



why 先监听在发送，还会冲突？因为电磁波在总线上传播有时延

争用期为2t，只要经过2t时间还没有检测出碰撞，就可以肯定这次发送不会发生碰撞。（t为单程端到端时延）

解决方法：截断二进制指数规避算法



**最小帧长问题：**

帧的的传输时延至少要两倍于信号在总线中的单程时延。否则会出现，信号已经发完了才检测到发生碰撞 

ps：

以太网规定最帧长为**64B**，凡小于64B的都是由于冲突而异常终止的无效帧。所以小于64B，会填充到64B再传送 



#### 7.CSMA/CA协议（carrier sense multiple access/collision avoidance）

载波监听多点接入/碰撞避免



> 为什么有这个协议：

主要是用于无线网，而CSMA/CD主要用于以太网（有线）。因为无线网络无法做到碰撞检测，不止一个方向。而且有隐蔽站的问题。

发送数据钱，先检测信道是否空闲。空闲则发送RTS（request to send），接受端收到RTS，响应CTS(clear to send)





#### 8.局域网

局域网简称LAN（Local area network），是指在某一区域内多台计算机组成的计算机组，使用**广播信道**



> 特点：
>
> 1. 覆盖的地理范围较小
> 2. 使用专门铺设的传输介质（双绞线，同轴电缆）进行联网，数据传输速率高（10Mb/s~10Gb/s）
> 3. 通信时延低，误码率低
> 4. 各站为平等关系
> 5. 多采用分布式控制和广播式通信



决定局域网的主要要素是：**<u>网络拓扑，传输介质，介质访问控制方法</u>**



局域网的网络拓扑结构：

1. 星型拓扑，有单点故障问题
2. 总线型拓扑，比较好，用的也最多
3. 环形拓扑，有单点故障问题
4. 树状拓扑，有单点故障问题





局域网介质访问控制方法：

1. CSMA/CD
2. 令牌总线：只有令牌持有者才能控制总线
3. 令牌环

局域网分类：

1. 以太网 IEEE802.3
2. 令牌环网 IEEE802.5
3. FDDI  IEEE802.8
4. ATM网 
5. **无线局域网（WLAN wireless local area network）：采用IEEE 802.11标准**



IEEE802标准：在1980年2月制定的



**局域网链路层的两个子层：**

逻辑链路控制子层（LLC子层）、介质访问控制子层（MAC子层）





##### 8.1 以太网

以太网使用CSMA/CD介质访问控制方法

1. 造价低廉
2. 应用最广泛
3. 满足网络速率要求10Mb/s~10Gb/s



以太网提供**无连接**，**不可靠**的服务



以太网传输介质发展：粗同轴电缆，细同轴电缆，双绞线+集线器



以太网拓扑：**逻辑上总线型，物理上星型**

MAC地址常用6个16进制数来表示：比如02-60-8c-e4-b1-21



**以太网MAC帧**：（数据报长度下限46是因为最小帧长度64-6-6-2-4得到的，1500是因为早期的RAM大小有限）

![TCP/IP协议族核心协议数据包长度探究| DaDo Wang' Blog](https://blog.wdado.com/2019/07/13/TCP-IP%E5%8D%8F%E8%AE%AE%E6%97%8F%E6%A0%B8%E5%BF%83%E5%8D%8F%E8%AE%AE%E9%95%BF%E5%BA%A6%E6%8E%A2%E7%A9%B6/%E4%BB%A5%E5%A4%AA%E7%BD%91V2%E4%B8%ADMAC%E5%B8%A7%E6%A0%BC%E5%BC%8F.jpg)



##### 8.2 无线局域网

有固定基础设施无线局域网。基础服务集，扩展的服务集

无固定基础设施无线局域网的自组织网络





#### 9.广域网

广域网（WAN，wide area network），通常跨接很大的物理范围，所覆盖的范围从几十公里到几千公里。 如因特网，是世界范围最大的广域网

ppp协议和HDLC协议

> **ppp协议**（point to point protocol）是目前使用最广泛的数据链路层协议，用户使用拨号电话接入因特网是一般都使用ppp协议。



ppp是**面向字节**的协议



> **HDLC协议**（high-level data link control,高级数据链路控制），**面向比特**的数据链路层协议



ppp和hdlc相同：均只支持**<u>全双工链路</u>**，都可以实现透明传输。都可以实现差错检测，但不纠正错误

ppp和hdlc异同：ppp面向字符，hdlc面向比特



#### 10.链路层设备

链路层扩展以太网：可以通过网桥和交换机来扩展



网桥：根据mac帧的目的地址对阵进行转发和过滤。

网桥优点：1. 过滤通信量；2.扩大了物理范围；3.提高了可靠性

网段：一般指一个计算机网络中使用同一物理层设备（传输介质，中继器，集线器）能够直接通信的那一部分

![吐血码万字长文搞懂了数据链路层- 小黑电脑](https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vbGVpeXVqaWEvY3Nkbi9yYXcvbWFzdGVyLyVFNyVCRCU5MSVFNiVBMSVBNS5wbmc?x-oss-process=image/format,png)

网桥分为：

1. 透明网桥：透明是指以太网上的站点并不知道所发送的帧经过那几个网桥，是一种即插即用的设备--具有自学习能力
2. 源路由网桥：发送帧是，把详细的最佳路由信息放在帧的首部



网桥接端口太少，所以就发展出交换机。

多接口网桥--以太网交换机

**交换机类型：**

1. **直通式交换机**：查完目的地址之后就立即转发。延迟小，但是可靠性差，不支持不同速率的端口交换
2. **存储转发式交换机**：将帧放入高速缓存，并检查是否正确，正确则转发，否则丢弃。延迟大，可靠性高，支持不同速率端口的交换。（目前常用的类型）

![8. 网络层设备：路由器- Computer Network](https://gblobscdn.gitbook.com/assets%2F-M8zvqNNVZctOHx6v8No%2F-ME3magMx6taYZhZPGd3%2F-ME3s8_QgLHdlE0UgHK_%2Fimage.png?alt=media&token=180616e2-4f47-419b-899e-69ca19416809)

### 四、网络层

网络层的主要任务是把**分组**从源端传到目的端，为分组交换网上的不同主机提供通信服务。网络层上传输的单位是**数据报**

功能1.**路由选择**和**分组转发**

功能2.异构网络互联

功能3.拥塞控制

> 分组是数据报的组成单元（整体和局部的关系，个人理解）

#### 1.数据交换方式

* 电路交换
* 报文交换：存储转发
* 分组交换：把大的数据块分割为小的数据块，然后进行存储转发

![电路交换、报文交换与分组交换- 知乎](https://pic4.zhimg.com/v2-c265127be7ffecc45f135140f83d7a77_b.jpg)

两种分组交换方式：

* 数据报方式（因特网在使用）：
  * 无连接（不事先为分组的传输确定传输路径，每个分组独立确定传输路径，可能出现不同）
  * 每个分组携带源和目的地址

* 虚电路方式：
  * 将数据报方式和电路交换相结合。

#### 2.路由算法

静态路由算法：管理员手工配置路由信息

动态路由算法（自适应路由算法）：路由器间彼此交换信息，按照路由算法优化出路由表项

	* 全局性：链路状态路由算法OSPF
	* 分散性：距离向量路由算法RIP



分层次的路由选择协议：

1. 因特网规模很大
2. 许多单位不想让外界知道自己的路由选择协议



路由选择协议分为：

* 内部网关协议 RIP OSPF
* 外部网关协议 BGP



##### 2.1RIP协议（Routing Information Protocol,路由网关协议，采用UDP报文）

适用于小互联网（距离16表示不可达，最多包涵16个路由器）

1. **和谁交换**：仅和**相邻路由器**交换信息

2. **交换什么**：交换的信息是自己的路由表

3. **多久交换**：**每30s**交换一次路由信息，然后根据新信息更新路由表。若超过180s没有收到邻居路由器的通知，则判定邻居没了，并更新路由表

经过若干次更新之后，所有路由器最终都会知道到达本自治系统任何一个网络的最短距离和下一条路由器的地址，即“收敛”

**RIP好消息传的快，坏消息传的慢**

##### 2.2 OSPF（Open Shortest Path First，开放式路径最短优先协议，采用IP报文）

可以用于规模很大的网络

1. **和谁交换**：自治系统内所有的路由器发送消息

2. **交换什么**：和RIP相比较，交换的信息是相邻路由器所有的链路状态（费用，距离，时延，带宽）
3. **多久交换**：只有当链路状态发生变化时，路由器才向所有路由器洪泛发送此消息

最后所有路由器都能建立一个链路状态数据库，即全网拓扑图

##### 2.3 BGP协议（Border Gateway Protocol，边界网关协议，采用TCP报文）

由于是一个外部网关协议，在不同的自治系统之间交换路由信息，由于网络环境复杂，需要保证可靠传输，所以采用TCP报文

1. **和谁交换**：与其他AS的邻站BGP发言人交换信息
2. **交换什么**：交换网络可达性信息，到达某个网络所要经过的一系列AS（autonomous system，自治系统）
3. **多久交换**：发生变化才会更新

![路由算法及路由协议—— BGP协议及路径向量算法_starter_____的博客-CSDN博客_bgp算法](https://img-blog.csdnimg.cn/20191025114953818.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N0YXJ0ZXJfX19fXw==,size_16,color_FFFFFF,t_70)

#### 3. IP数据报

IPv4：其中的v是指版本

![这里写图片描述](https://img-blog.csdn.net/20180711172816461?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1RpYW56ZXo=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)

##### 3.2IP数据报**分片**

最大传送单元MTU。以太网的MTU时1500字节

如果所传送的数据超过MTU：那么可以进行分片（DF=0）（DF表示don't fragment，DF=1禁止分片，为0允许分片）



#### 4. IPv4地址

ip地址：全世界唯一的32位/4字节标识符，由网络号+主机号构成

点分十进制

![img](https://pic3.zhimg.com/80/v2-13c1daebb7b5706a847f4e727d9dacde_1440w.jpg)

> 特殊ip地址

在IP地址中有一些并不是来标注主机的，这些地址具有特殊的意义。这些地址包括网络地址、直接广播地址、受限广播地址、本网络地址、环回地址等。

> 私有IP地址

我们企业或家庭内部组建局域网用的IP，一般都会用私有IP。

![浅谈问题：为什么既要有Mac地址又要有IP地址_成天天的博客-CSDN博客_为什么有mac地址还要ip地址](https://img-blog.csdnimg.cn/20190420165608856.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTEzODA3MQ==,size_16,color_FFFFFF,t_70)

##### 4.1网络地址转换NAT（network address translation）

路由器对目的地址是私有ip的数据报一律不进行转发，因此需要网络地址转换



##### 4.2 子网划分和子网掩码

子网划分：将主机号中位数较高的地方改为子网号，变为三级ip地址。

外部无法看到本单位内子网划分情况，只能看到网络号

![网络基础知识--子网划分- 战争热诚- 博客园](https://images2017.cnblogs.com/blog/1226410/201801/1226410-20180117214150506-638807042.png)



子网掩码：网络号对应的位全为1，主机地址对应的位全为0，比如255.255.0.0。这样子就可以在局域网中找到对应子网中的主机了

![子网划分和子网掩码计算方法| Manayakko - 微笑才是王道](/0077TIyQgy1gcmq2fv8ckj30pf0fy75p.jpg)





##### 4.3 无类别域间路由CIDR（Classless Inter-Domain Routing）

1. 消除了传统A类，B类和C类以及划分子网的概念。 
   * 记法：IP地址后边加上“/”。然后写上网络前缀的位数。eg. 128.14.32.0/20 表示前20位是网络前缀
2. 融合子网地址与子网掩码，方便子网划分。



##### 4.4 超网

它是把一些小网络组合成一个大网络，就是超网

![超网合并详解_涤生手记-CSDN博客](/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk=.png)

#### 5.ARP协议（Address Resolution Protocol,地址解析协议）

在实际网络的链路上传送数据帧时，最终必须使用mac地址

ARP协议：完成主机或者路由器IP地址到mac地址的映射

可以参考这个帖子：https://juejin.cn/post/6844903666445451272



#### 6.DHCP（Dynamic Host Configuration Protocol，动态主机配置协议）

DHCP时**应用层协议**，使用**客户/服务器**方式，客户端和服务端通过**广播**进行交互

提供即插即用联网机制，主机可以从服务器动态获取ip地址，子网掩码，默认网关，DNS服务器。允许地址重用

> 过程：
>
> 1. 主机广播<u>**DHCP发现**</u>报文......"有没有DHCP服务器啊？"
>
> 2. DHCP服务器广播**<u>DHCP提供</u>**报文......"有，有，有"
> 3. 主机广播**<u>DHCP请求</u>**报文......"我能要一个ip么？"
> 4. DHCP服务器广播**<u>DHCP确认</u>**报文......"没问题，你用吧"

#### 7.ICMP协议（Internet Control Message Protocol，internet控制报文协议）

分类：

1. ICMP差错报告报文
   * 终点不可达
   * 原点抑制
   * 时间超过
   * 参数问题
   * 改变路由
2. ICMP询问报文
   * 回送请求和回答报文
   * 时间戳请求和回答报文



应用：

1. **ping** 测试两个主机之间的连通性
2. traceroute 计算路径长短



#### 8.IPv6

![网络层——IPv6 概述- 乌漆WhiteMoon - 博客园](/1774310-20200601163428619-302260343.png)

每个沙粒都能分配到一个地址



与IPv4的区别：

1. IPv6将地址从IPv4的**32位扩大到了128位**
2. IPv6将IPv4中的校验和字段彻底移出
3. IPv6支持**即插即用（即自动配置）**，不需要DHCP协议

IPv6表示形式：

冒号十六进制记法：4BF5:4BF5:4BF5:4BF5:4BF5:4BF5:4BF5:4BF5



IPv4到IPv6的过渡策略：

1.双栈协议：同时支持两种协议

2.隧道技术



#### 9.IP组播

* 单播：点对点
* 广播：点对多点
* 组播：点对多点，组播路由器

IP组播地址：

属于多播组的设备将被分配一个**组播组IP地址**（一群共同需求主机的相同标识）

组播地址范围为224.0.0.0～239.255.255.255（D类地址）。只能用作分组的**目的地址**，源地址总是为**单播地址**



1.组播数据报时“尽最大努力交付”，不提供可靠交付，应用于UDP

2.对组播数据不产生ICMP差错报文

3.并非所有D类都可以作为组播地址



IGMP、组播路由选择协议



#### 10.移动IP

Key words

移动IP技术时移动节点以固定的网络IP地址，实现跨越不同网段的**漫游功能**，并保证了基于网络IP的网络权限在漫游过程中不发生任何变化

**移动节点**：具有永久IP地址的移动和设备

**归属代理**：一个移动节点拥有的“居所”称为归属网络，在归属网络中代表移动节点执行移动管理功能的实体称为归属代理

**外部代理**：在外部网络中帮助移动节点完成移动管理功能的实体称为外部代理

**永久地址**：移动站点在归属网络中的原始地址

**转交地址**：移动网络在外部网络中使用的临时地址

![在这里插入图片描述](https://img-blog.csdnimg.cn/20191026111158313.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N0YXJ0ZXJfX19fXw==,size_16,color_FFFFFF,t_70)

![移动IP —— 移动IP的概念和通信过程_starter_____的博客-CSDN博客_移动ip](https://img-blog.csdnimg.cn/20191026111218469.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N0YXJ0ZXJfX19fXw==,size_16,color_FFFFFF,t_70)



#### 11.网络层设备

路由器是一种具有多个输入端口和多个输出端口的专用计算机，其任务是转发分组



三层设备的区别：

路由器：可以互联两个不同网络层协议的网段

网桥：可以互联两个物理层和链路层不同的网段

集线器：不能互联两个物理层不同的网段







### 五、传输层

只有主机才有的层次

传输层为应用层（上层）提供通信服务，使用网络层的服务

传输层的功能：

1. 传输层提供**进程到进程**之间的逻辑通信。网络层提供主机之间的逻辑通信
2. **复用和分用**。类似于一个家庭共有一个信箱发送信件，和接受信件
3. 传输层对收到的报文进行差错检测
4. 传输层的两种协议**TCP**和**UDP**



TCP：可靠，面向连接，时延大，适用于大文件

UDP：不可靠，无连接，时延小，适用于小文件



QQ上发送消息，就是UDP，传送大文件就是TCP



传输层的寻址和端口：

复用：应用层所有的应用进程都可以通过传输层在传输到网络层

分用：传输层从网络层收到数据后交付给指明的应用进程

逻辑端口/软件端口：是传输层的SAP，表示主机的应用进程

端口长度为16bit，可以表示65536个不同的端口号



端口号可以分为：

1. 服务端使用
   1. 熟知端口号：给TCP/IP最重要的一些应用程序，让所有用户都知道 0～1023
   2. 登记端口号：为没有熟知端口号的程序使用1024～49151
2. 客户端使用：仅在客户进程运行时才动态选择49152～65535

![img](https://img-blog.csdnimg.cn/20201108092835240.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpdTE3MjM0MDUw,size_16,color_FFFFFF,t_70)



在网络中采用发送方和接受方的套接字来表示端点，**<u>套接字</u>**唯一标识了网络中的一个主机和他上面的进程：

**<u>套接字socket=（主机IP地址，端口号）</u>**



#### 5.2 UDP协议

特点：

1. UDP时**无连接**的，见小开销和发送数据之前的时延
2. UDP使用最大努力交付，即**不保证可靠交付**
3. UDP时面**向报文**的，适合一次传输少量数据的网络应用
4. UDP无拥塞控制，适合很多**实时应用**。IP电话，视频

5. UDP首部8B，比较短

![UDP段格式](http://docs.linuxtone.org/ebooks/C&CPP/c/images/tcpip.udpformat.png)

#### 5.3 TCP协议

1. TCP时**面向连接**的
2. 每个TCP只能是**点对点**
3. 可靠有序，不丢不重
4. **TCP提供**全双工通信

![TCP/IP学习笔记（九）TCP报文段首部格式_一个程序渣渣的小后院-CSDN博客](https://s1.ax1x.com/2018/03/02/9rzlJf.png)

控制位	作用
ACK	置1时表示确认号合法，为0的时候表示数据段不包含确认信息，确认号被忽略。
PSH	置1时请求的数据段在接收方得到后就可直接送到应用程序，而不必等到缓冲区满时才传送
RST	置1时重建连接。如果接收到RST位时候，通常发生了某些错误
SYN	置1时用来发起一个连接
FIN	置1时表示发端完成发送任务。用来释放连接，表明发送方已经没有数据发送了
URG	紧急指针，告诉接收TCP模块紧要指针域指着紧要数据



**源端口、目标端口**：计算机上的进程要和其他进程通信是要通过计算机端口的，而一个计算机端口某个时刻只能被一个进程占用，所以通过指定源端口和目标端口，就可以知道是哪两个进程需要通信。源端口、目标端口是用16位表示的，可推算计算机的端口个数为2^16个。

**序列号**：表示本报文段所发送数据的第一个字节的编号。

**确认号**：表示接收方期望收到发送方下一个报文段的第一个字节数据的编号。

**TCP首部长度**：由于TCP首部包含一个长度可变的选项部分，所以需要这么一个值来指定这个TCP报文段到底有多长。或者可以这么理解：就是表示TCP报文段中数据部分在整个TCP报文段中的位置。

**窗口大小**：表示现在运行对方发送的数据量。也就是告诉对方，从本报文段的确认号开始允许对方发送的数据量。



##### 5.3.1 TCP连接管理

TCP连接传输三个阶段：连接建立，数据传送，连接释放

seq就是首部中的序号

![ ](https://www.programmersought.com/images/96/034c8bf3376b0f8b65ca8b74be060aa0.png)



> SYN洪泛攻击
>
> 发送大量SYN请求



TCP连接释放

![ ](https://www.programmersought.com/images/17/7b5fb1813001519c4d1194e6ca51b8e9.png)



##### 5.5.2 TCP可靠传输

传输层：使用TCP实现可靠传输

网络层：提供尽最大努力交付，不可靠传输



TCP确认和重传

TCP采用累计确认

TCP采用自适应算法，动态改变重传时间RTTs（加权平均往返时间，smooth）



##### 5.5.3TCP流量控制

流量控制：让发送方慢点，要让接受方来得及接收

TCP采用**滑动窗口**机制实现流量控制（发送窗口大小可以动态变化）



##### 5.5.4TCP拥塞控制

出现拥塞的条件：对资源需求的总和>可用资源



防止过多的数据注入到网络中--全局性

（流量控制是一种点对点之间的问题）



拥塞控制四种算法：

1. 慢开始
2. 拥塞避免
3. 快重传
4. 快恢复

![img](https://img2020.cnblogs.com/blog/1265453/202005/1265453-20200512100320079-1060465617.png)



![img](https://img2020.cnblogs.com/blog/1265453/202005/1265453-20200512112149850-218362862.png)





### 六、应用层

应用层应用模型：客户服务器模型，P2P模型（peer to peer）

#### 6.2DNS系统

域名：www.cskaoyan.com 不区分大小写。com是顶级域名，cskaoyan二级域名，www三级域名

![img](https://upload-images.jianshu.io/upload_images/2965532-5aa5abf1d3fd628a.png?imageMogr2/auto-orient/strip|imageView2/2/w/574)



域名服务器：

1. 根域名服务器：全球一共有13台根域名服务器. a.rootservers.net~m.rootservers.net. 但是有很多镜像服务器

2. 顶级域名服务器

3. 权限域名服务器

4. 本地域名服务器



域名解析过程：

1. 递归查询（靠别人）

2. 迭代查询（靠自己）

利用高速缓存可以加快域名解析过程



#### 6.3 文件传输协议FTP（file transfer protocol）

TFTP(简单文件传输协议，trivial file transfer protocol)



服务器和客户端之间的拷贝：上传和下载



FTP工作原理：

登陆：ftp地址 用户名&密码或者匿名登陆

FTP使用TCP实现可靠传输



> 控制连接始终保持
>
> 数据连接保持一会儿

#### 6.4电子邮件



![6.4 你真的了解电子邮件系统的组成和结构吗？（SMTP、POP3、IMAP、MIME……）_BitHachi-CSDN博客](https://img-blog.csdnimg.cn/20200503095515993.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzkxNDYwNA==,size_16,color_FFFFFF,t_70)

##### 6.4.1SMTP协议（简单邮件传送协议）和POP3协议（邮局协议）

> SMTP：

规定了两个相互通信的SMTP进程之间如何交换信息



该协议采用TCP连接，端口号25，C/S架构

三个阶段：连接建立，邮件发送，连接释放



缺点：

1. 不能传送可执行文件或其他二进制对象
2. 仅限于传送7位ASCII码，不能传送其他非英语国家的文字
3. 会拒绝超过一定长度的邮件

因此使用通用因特网邮件扩充**MIME**：使电子邮件支持声音、图像、视频、多国家语言等。**使传输内容丰富多彩**



> POP3协议. 3代表第三版

该协议采用TCP连接，端口号110，C/S架构

> IMAP协议网际报文存取协议

可以不看图片

> 基于万维网的电子邮件

两端使用HTTP协议



#### 6.5 万维网 WWW

万维网WWW（world wide web）是一个大规模、联机式的信息存储所/资源空间

**统一资源定位符URL**：唯一标识资源（文字，视频，音频）

URL一般形式：<协议>://<主机>:<端口>/<路径>

​							http		域名

​							ftp			ip地址



用户通过点击超链接（http://www.baidu.com）获取资源，这些资源通过**超文本传输协议（HTTP）**传送给使用者

万维网使用**超文本标记语言HTML**，是的万维网网页设计者可以方便的从一个界面跳转到另一个界面，并且显示出来



HTTP特点：

1. HTTP协议是无状态的，但是实际工作中有些网站总希望识别用户，比如淘宝-->cookie
2. cookie时存储在**用户主机中的文本文件**，记录一段时间内某用户（使用识别码识别）的访问记录-->提供个性化服务
3. HTTP采用TCP运输层协议，到那时HTTP是**无连接**的

两种连接方式：

1. 非持久连接
2. 持久连接：发送链接之后，仍然保持连接



HTTP报文结构：

![HTTP报文结构- 简书](https://lh3.googleusercontent.com/proxy/mfUCFiqoEJ2K5Wfa9BgZBAf5i0a9gXMaTXcgEG0fCPy11TfFLwhrHKIBRP9KJd96UbqQnWunBIDzuDbreXLJRRXYeEW7ihhcR-Eyn7P9IQFkiRYzH6a4_k9QT8JM88VmXRnN)

![http报文和协议首部_weixin_30888027的博客-CSDN博客](https://images2018.cnblogs.com/blog/1250974/201802/1250974-20180223120728672-2127185812.png)